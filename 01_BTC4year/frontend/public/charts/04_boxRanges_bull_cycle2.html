<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cycle 2 Bull - Box Range Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { height: 100%; }
        body { height: 100%; overflow-x: hidden; overflow-y: auto; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(180deg, #020617 0%, #0F172A 100%); min-height: 100vh; padding: 20px; display: flex; flex-direction: column; }
        .container { flex: 1; display: flex; flex-direction: column; max-width: 1400px; width: 100%; margin: 0 auto; min-height: 0; }
        .chart-wrapper { flex: 1; display: flex; flex-direction: column; background: linear-gradient(135deg, #0F172A 0%, #1E293B 50%, #0F172A 100%); border-radius: 16px; padding: 20px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.05); min-height: 0; }
        .header { flex-shrink: 0; display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 12px; }
        .header h2 { font-size: 18px; font-weight: 700; color: #F8FAFC; }
        .header p { font-size: 12px; color: #64748B; margin-top: 4px; }
        #chart { flex: 1; margin: 0 -12px; min-height: 0; }
        .footer { flex-shrink: 0; display: flex; justify-content: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.06); font-size: 11px; color: #64748B; }
        
        /* 모바일 대응 */
        @media (max-width: 768px) {
            body { padding: 12px; }
            .chart-wrapper { padding: 12px; border-radius: 12px; min-height: 450px; }
            .header h2 { font-size: 14px; }
            .header p { font-size: 10px; }
            #chart { margin: 0 -6px; min-height: 350px; }
            .footer { font-size: 9px; margin-top: 8px; padding-top: 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chart-wrapper">
            <div class="header">
                <div>
                    <h2>Cycle 2 Bull (2019.02~2021.11) - Correction Box Range Analysis</h2>
                    <p>Drop ≥5.0%, Breakup &lt;2.0%</p>
                </div>
            </div>
            <div id="chart"></div>
            <div class="footer">Data source: Supabase BTC/USDT OHLCV (Day 420~1423)</div>
        </div>
    </div>
    <script>
        var series = [{"name": "Cycle 2", "data": [{"x": 420, "y": 21.29}, {"x": 421, "y": 20.98}, {"x": 422, "y": 21.01}, {"x": 423, "y": 21.01}, {"x": 424, "y": 20.91}, {"x": 425, "y": 20.92}, {"x": 426, "y": 20.68}, {"x": 427, "y": 20.83}, {"x": 428, "y": 20.8}, {"x": 429, "y": 21.1}, {"x": 430, "y": 22.38}, {"x": 431, "y": 22.77}, {"x": 432, "y": 22.73}, {"x": 433, "y": 22.9}, {"x": 434, "y": 22.74}, {"x": 435, "y": 23.73}, {"x": 436, "y": 23.93}, {"x": 437, "y": 22.08}, {"x": 438, "y": 21.9}, {"x": 439, "y": 21.89}, {"x": 440, "y": 22.17}, {"x": 441, "y": 21.99}, {"x": 442, "y": 21.9}, {"x": 443, "y": 21.86}, {"x": 444, "y": 21.84}, {"x": 445, "y": 22.1}, {"x": 446, "y": 22.28}, {"x": 447, "y": 22.27}, {"x": 448, "y": 22.42}, {"x": 449, "y": 22.64}, {"x": 450, "y": 22.48}, {"x": 451, "y": 22.45}, {"x": 452, "y": 22.26}, {"x": 453, "y": 22.2}, {"x": 454, "y": 22.35}, {"x": 455, "y": 22.46}, {"x": 456, "y": 23.13}, {"x": 457, "y": 22.87}, {"x": 458, "y": 23.02}, {"x": 459, "y": 22.98}, {"x": 460, "y": 23.09}, {"x": 461, "y": 23.2}, {"x": 462, "y": 22.85}, {"x": 463, "y": 22.91}, {"x": 464, "y": 22.84}, {"x": 465, "y": 22.8}, {"x": 466, "y": 22.57}, {"x": 467, "y": 23.08}, {"x": 468, "y": 23.03}, {"x": 469, "y": 23.51}, {"x": 470, "y": 23.6}, {"x": 471, "y": 23.47}, {"x": 472, "y": 23.71}, {"x": 473, "y": 27.92}, {"x": 474, "y": 30.07}, {"x": 475, "y": 28.73}, {"x": 476, "y": 28.67}, {"x": 477, "y": 29.68}, {"x": 478, "y": 29.84}, {"x": 479, "y": 30.25}, {"x": 480, "y": 29.87}, {"x": 481, "y": 30.91}, {"x": 482, "y": 30.4}, {"x": 483, "y": 28.97}, {"x": 484, "y": 29.07}, {"x": 485, "y": 29.38}, {"x": 486, "y": 29.46}, {"x": 487, "y": 29.63}, {"x": 488, "y": 29.82}, {"x": 489, "y": 30.14}, {"x": 490, "y": 30.33}, {"x": 491, "y": 30.41}, {"x": 492, "y": 30.3}, {"x": 493, "y": 30.79}, {"x": 494, "y": 31.93}, {"x": 495, "y": 31.83}, {"x": 496, "y": 31.31}, {"x": 497, "y": 31.41}, {"x": 498, "y": 30.46}, {"x": 499, "y": 30.44}, {"x": 500, "y": 30.4}, {"x": 501, "y": 30.44}, {"x": 502, "y": 30.8}, {"x": 503, "y": 31.57}, {"x": 504, "y": 33.32}, {"x": 505, "y": 33.64}, {"x": 506, "y": 33.3}, {"x": 507, "y": 33.1}, {"x": 508, "y": 34.37}, {"x": 509, "y": 34.29}, {"x": 510, "y": 35.49}, {"x": 511, "y": 36.88}, {"x": 512, "y": 41.87}, {"x": 513, "y": 42.88}, {"x": 514, "y": 46.18}, {"x": 515, "y": 47.7}, {"x": 516, "y": 47.03}, {"x": 517, "y": 47.43}, {"x": 518, "y": 45.18}, {"x": 519, "y": 42.52}, {"x": 520, "y": 47.18}, {"x": 521, "y": 46.5}, {"x": 522, "y": 45.85}, {"x": 523, "y": 45.7}, {"x": 524, "y": 45.27}, {"x": 525, "y": 46.35}, {"x": 526, "y": 46.13}, {"x": 527, "y": 49.83}, {"x": 528, "y": 50.79}, {"x": 529, "y": 50.16}, {"x": 530, "y": 49.89}, {"x": 531, "y": 51.74}, {"x": 532, "y": 49.0}, {"x": 533, "y": 49.18}, {"x": 534, "y": 50.26}, {"x": 535, "y": 50.18}, {"x": 536, "y": 46.27}, {"x": 537, "y": 45.02}, {"x": 538, "y": 44.86}, {"x": 539, "y": 46.18}, {"x": 540, "y": 45.87}, {"x": 541, "y": 45.24}, {"x": 542, "y": 45.72}, {"x": 543, "y": 45.67}, {"x": 544, "y": 46.75}, {"x": 545, "y": 47.38}, {"x": 546, "y": 49.51}, {"x": 547, "y": 50.54}, {"x": 548, "y": 53.21}, {"x": 549, "y": 53.84}, {"x": 550, "y": 53.23}, {"x": 551, "y": 53.04}, {"x": 552, "y": 54.68}, {"x": 553, "y": 58.01}, {"x": 554, "y": 63.63}, {"x": 555, "y": 64.95}, {"x": 556, "y": 63.53}, {"x": 557, "y": 67.56}, {"x": 558, "y": 79.65}, {"x": 559, "y": 76.84}, {"x": 560, "y": 71.15}, {"x": 561, "y": 70.93}, {"x": 562, "y": 69.44}, {"x": 563, "y": 64.32}, {"x": 564, "y": 62.37}, {"x": 565, "y": 68.37}, {"x": 566, "y": 68.42}, {"x": 567, "y": 65.03}, {"x": 568, "y": 66.51}, {"x": 569, "y": 65.78}, {"x": 570, "y": 70.34}, {"x": 571, "y": 72.95}, {"x": 572, "y": 74.96}, {"x": 573, "y": 69.05}, {"x": 574, "y": 67.76}, {"x": 575, "y": 67.28}, {"x": 576, "y": 65.29}, {"x": 577, "y": 63.28}, {"x": 578, "y": 62.87}, {"x": 579, "y": 56.77}, {"x": 580, "y": 61.51}, {"x": 581, "y": 61.4}, {"x": 582, "y": 63.11}, {"x": 583, "y": 61.68}, {"x": 584, "y": 60.91}, {"x": 585, "y": 58.97}, {"x": 586, "y": 56.65}, {"x": 587, "y": 58.01}, {"x": 588, "y": 56.39}, {"x": 589, "y": 58.09}, {"x": 590, "y": 54.7}, {"x": 591, "y": 55.47}, {"x": 592, "y": 55.38}, {"x": 593, "y": 57.64}, {"x": 594, "y": 59.68}, {"x": 595, "y": 60.83}, {"x": 596, "y": 62.17}, {"x": 597, "y": 62.94}, {"x": 598, "y": 68.06}, {"x": 599, "y": 70.3}, {"x": 600, "y": 69.22}, {"x": 601, "y": 68.76}, {"x": 602, "y": 68.68}, {"x": 603, "y": 68.33}, {"x": 604, "y": 66.14}, {"x": 605, "y": 66.01}, {"x": 606, "y": 65.32}, {"x": 607, "y": 62.13}, {"x": 608, "y": 59.64}, {"x": 609, "y": 60.07}, {"x": 610, "y": 59.67}, {"x": 611, "y": 59.86}, {"x": 612, "y": 62.32}, {"x": 613, "y": 62.43}, {"x": 614, "y": 61.6}, {"x": 615, "y": 58.39}, {"x": 616, "y": 59.55}, {"x": 617, "y": 59.4}, {"x": 618, "y": 58.91}, {"x": 619, "y": 60.46}, {"x": 620, "y": 59.24}, {"x": 621, "y": 58.72}, {"x": 622, "y": 55.44}, {"x": 623, "y": 55.28}, {"x": 624, "y": 55.21}, {"x": 625, "y": 56.04}, {"x": 626, "y": 59.58}, {"x": 627, "y": 61.42}, {"x": 628, "y": 61.57}, {"x": 629, "y": 62.14}, {"x": 630, "y": 62.18}, {"x": 631, "y": 60.19}, {"x": 632, "y": 60.39}, {"x": 633, "y": 59.75}, {"x": 634, "y": 59.21}, {"x": 635, "y": 58.68}, {"x": 636, "y": 59.57}, {"x": 637, "y": 59.52}, {"x": 638, "y": 59.41}, {"x": 639, "y": 59.07}, {"x": 640, "y": 59.04}, {"x": 641, "y": 58.58}, {"x": 642, "y": 58.48}, {"x": 643, "y": 58.87}, {"x": 644, "y": 58.62}, {"x": 645, "y": 58.02}, {"x": 646, "y": 57.52}, {"x": 647, "y": 57.3}, {"x": 648, "y": 55.84}, {"x": 649, "y": 49.77}, {"x": 650, "y": 48.27}, {"x": 651, "y": 47.12}, {"x": 652, "y": 47.41}, {"x": 653, "y": 46.92}, {"x": 654, "y": 47.53}, {"x": 655, "y": 48.46}, {"x": 656, "y": 47.74}, {"x": 657, "y": 47.85}, {"x": 658, "y": 46.94}, {"x": 659, "y": 46.66}, {"x": 660, "y": 46.49}, {"x": 661, "y": 47.32}, {"x": 662, "y": 47.46}, {"x": 663, "y": 49.43}, {"x": 664, "y": 49.28}, {"x": 665, "y": 50.05}, {"x": 666, "y": 47.89}, {"x": 667, "y": 48.18}, {"x": 668, "y": 47.83}, {"x": 669, "y": 47.91}, {"x": 670, "y": 46.64}, {"x": 671, "y": 46.32}, {"x": 672, "y": 46.27}, {"x": 673, "y": 46.17}, {"x": 674, "y": 47.3}, {"x": 675, "y": 47.51}, {"x": 676, "y": 47.31}, {"x": 677, "y": 45.88}, {"x": 678, "y": 42.78}, {"x": 679, "y": 50.17}, {"x": 680, "y": 59.12}, {"x": 681, "y": 55.84}, {"x": 682, "y": 56.45}, {"x": 683, "y": 54.45}, {"x": 684, "y": 53.65}, {"x": 685, "y": 53.62}, {"x": 686, "y": 52.9}, {"x": 687, "y": 53.44}, {"x": 688, "y": 53.38}, {"x": 689, "y": 54.24}, {"x": 690, "y": 53.91}, {"x": 691, "y": 53.83}, {"x": 692, "y": 53.45}, {"x": 693, "y": 52.8}, {"x": 694, "y": 50.63}, {"x": 695, "y": 52.15}, {"x": 696, "y": 51.72}, {"x": 697, "y": 50.67}, {"x": 698, "y": 50.43}, {"x": 699, "y": 50.17}, {"x": 700, "y": 50.11}, {"x": 701, "y": 48.71}, {"x": 702, "y": 49.23}, {"x": 703, "y": 48.48}, {"x": 704, "y": 46.86}, {"x": 705, "y": 47.12}, {"x": 706, "y": 46.38}, {"x": 707, "y": 44.19}, {"x": 708, "y": 41.87}, {"x": 709, "y": 41.79}, {"x": 710, "y": 42.06}, {"x": 711, "y": 41.85}, {"x": 712, "y": 43.64}, {"x": 713, "y": 43.58}, {"x": 714, "y": 44.76}, {"x": 715, "y": 44.53}, {"x": 716, "y": 43.0}, {"x": 717, "y": 42.31}, {"x": 718, "y": 42.19}, {"x": 719, "y": 44.19}, {"x": 720, "y": 42.67}, {"x": 721, "y": 43.27}, {"x": 722, "y": 43.44}, {"x": 723, "y": 43.12}, {"x": 724, "y": 43.62}, {"x": 725, "y": 42.23}, {"x": 726, "y": 41.48}, {"x": 727, "y": 41.59}, {"x": 728, "y": 41.67}, {"x": 729, "y": 41.46}, {"x": 730, "y": 41.05}, {"x": 731, "y": 40.76}, {"x": 732, "y": 39.58}, {"x": 733, "y": 42.42}, {"x": 734, "y": 42.08}, {"x": 735, "y": 41.16}, {"x": 736, "y": 41.0}, {"x": 737, "y": 42.87}, {"x": 738, "y": 43.87}, {"x": 739, "y": 42.4}, {"x": 740, "y": 41.46}, {"x": 741, "y": 42.39}, {"x": 742, "y": 41.48}, {"x": 743, "y": 41.99}, {"x": 744, "y": 42.92}, {"x": 745, "y": 42.24}, {"x": 746, "y": 41.73}, {"x": 747, "y": 41.36}, {"x": 748, "y": 41.12}, {"x": 749, "y": 42.22}, {"x": 750, "y": 42.21}, {"x": 751, "y": 42.73}, {"x": 752, "y": 44.44}, {"x": 753, "y": 46.79}, {"x": 754, "y": 48.2}, {"x": 755, "y": 45.93}, {"x": 756, "y": 46.75}, {"x": 757, "y": 47.24}, {"x": 758, "y": 46.73}, {"x": 759, "y": 46.73}, {"x": 760, "y": 50.63}, {"x": 761, "y": 50.84}, {"x": 762, "y": 50.51}, {"x": 763, "y": 51.55}, {"x": 764, "y": 51.25}, {"x": 765, "y": 52.45}, {"x": 766, "y": 49.87}, {"x": 767, "y": 50.11}, {"x": 768, "y": 50.27}, {"x": 769, "y": 49.55}, {"x": 770, "y": 48.62}, {"x": 771, "y": 48.18}, {"x": 772, "y": 49.13}, {"x": 773, "y": 51.31}, {"x": 774, "y": 53.59}, {"x": 775, "y": 53.87}, {"x": 776, "y": 54.61}, {"x": 777, "y": 54.33}, {"x": 778, "y": 53.96}, {"x": 779, "y": 54.03}, {"x": 780, "y": 54.84}, {"x": 781, "y": 53.31}, {"x": 782, "y": 55.56}, {"x": 783, "y": 56.23}, {"x": 784, "y": 56.36}, {"x": 785, "y": 56.67}, {"x": 786, "y": 57.96}, {"x": 787, "y": 58.08}, {"x": 788, "y": 58.86}, {"x": 789, "y": 59.58}, {"x": 790, "y": 59.86}, {"x": 791, "y": 59.19}, {"x": 792, "y": 59.15}, {"x": 793, "y": 57.3}, {"x": 794, "y": 56.81}, {"x": 795, "y": 58.44}, {"x": 796, "y": 58.44}, {"x": 797, "y": 55.3}, {"x": 798, "y": 55.62}, {"x": 799, "y": 55.35}, {"x": 800, "y": 56.96}, {"x": 801, "y": 56.96}, {"x": 802, "y": 55.16}, {"x": 803, "y": 53.46}, {"x": 804, "y": 51.15}, {"x": 805, "y": 50.74}, {"x": 806, "y": 50.11}, {"x": 807, "y": 49.89}, {"x": 808, "y": 51.12}, {"x": 809, "y": 50.85}, {"x": 810, "y": 50.45}, {"x": 811, "y": 52.22}, {"x": 812, "y": 52.28}, {"x": 813, "y": 52.38}, {"x": 814, "y": 50.67}, {"x": 815, "y": 46.63}, {"x": 816, "y": 46.46}, {"x": 817, "y": 45.5}, {"x": 818, "y": 45.42}, {"x": 819, "y": 33.95}, {"x": 820, "y": 32.16}, {"x": 821, "y": 33.87}, {"x": 822, "y": 30.59}, {"x": 823, "y": 31.5}, {"x": 824, "y": 30.99}, {"x": 825, "y": 36.49}, {"x": 826, "y": 39.34}, {"x": 827, "y": 36.81}, {"x": 828, "y": 36.53}, {"x": 829, "y": 37.63}, {"x": 830, "y": 38.96}, {"x": 831, "y": 39.67}, {"x": 832, "y": 38.65}, {"x": 833, "y": 39.01}, {"x": 834, "y": 36.26}, {"x": 835, "y": 35.72}, {"x": 836, "y": 37.62}, {"x": 837, "y": 37.19}, {"x": 838, "y": 38.08}, {"x": 839, "y": 41.04}, {"x": 840, "y": 40.18}, {"x": 841, "y": 39.85}, {"x": 842, "y": 39.31}, {"x": 843, "y": 41.93}, {"x": 844, "y": 42.53}, {"x": 845, "y": 42.3}, {"x": 846, "y": 42.03}, {"x": 847, "y": 41.6}, {"x": 848, "y": 39.59}, {"x": 849, "y": 40.92}, {"x": 850, "y": 39.36}, {"x": 851, "y": 39.78}, {"x": 852, "y": 39.53}, {"x": 853, "y": 40.99}, {"x": 854, "y": 40.75}, {"x": 855, "y": 41.58}, {"x": 856, "y": 41.43}, {"x": 857, "y": 41.16}, {"x": 858, "y": 39.57}, {"x": 859, "y": 40.8}, {"x": 860, "y": 44.12}, {"x": 861, "y": 43.42}, {"x": 862, "y": 43.93}, {"x": 863, "y": 43.9}, {"x": 864, "y": 44.42}, {"x": 865, "y": 44.36}, {"x": 866, "y": 51.04}, {"x": 867, "y": 53.93}, {"x": 868, "y": 51.65}, {"x": 869, "y": 51.37}, {"x": 870, "y": 52.45}, {"x": 871, "y": 51.03}, {"x": 872, "y": 51.99}, {"x": 873, "y": 53.56}, {"x": 874, "y": 57.4}, {"x": 875, "y": 57.22}, {"x": 876, "y": 56.52}, {"x": 877, "y": 54.59}, {"x": 878, "y": 52.27}, {"x": 879, "y": 51.19}, {"x": 880, "y": 53.58}, {"x": 881, "y": 56.67}, {"x": 882, "y": 56.13}, {"x": 883, "y": 54.66}, {"x": 884, "y": 56.37}, {"x": 885, "y": 56.73}, {"x": 886, "y": 56.43}, {"x": 887, "y": 56.11}, {"x": 888, "y": 54.61}, {"x": 889, "y": 52.86}, {"x": 890, "y": 53.07}, {"x": 891, "y": 53.01}, {"x": 892, "y": 51.2}, {"x": 893, "y": 51.41}, {"x": 894, "y": 52.59}, {"x": 895, "y": 54.88}, {"x": 896, "y": 54.76}, {"x": 897, "y": 55.53}, {"x": 898, "y": 55.3}, {"x": 899, "y": 59.18}, {"x": 900, "y": 58.32}, {"x": 901, "y": 55.25}, {"x": 902, "y": 56.34}, {"x": 903, "y": 56.18}, {"x": 904, "y": 55.5}, {"x": 905, "y": 55.88}, {"x": 906, "y": 55.87}, {"x": 907, "y": 56.31}, {"x": 908, "y": 56.97}, {"x": 909, "y": 56.81}, {"x": 910, "y": 54.49}, {"x": 911, "y": 54.13}, {"x": 912, "y": 54.05}, {"x": 913, "y": 54.13}, {"x": 914, "y": 54.67}, {"x": 915, "y": 54.53}, {"x": 916, "y": 54.1}, {"x": 917, "y": 53.81}, {"x": 918, "y": 53.56}, {"x": 919, "y": 53.72}, {"x": 920, "y": 55.76}, {"x": 921, "y": 55.42}, {"x": 922, "y": 55.13}, {"x": 923, "y": 53.25}, {"x": 924, "y": 53.01}, {"x": 925, "y": 52.43}, {"x": 926, "y": 52.4}, {"x": 927, "y": 52.67}, {"x": 928, "y": 52.48}, {"x": 929, "y": 52.98}, {"x": 930, "y": 52.81}, {"x": 931, "y": 52.02}, {"x": 932, "y": 52.4}, {"x": 933, "y": 52.14}, {"x": 934, "y": 53.45}, {"x": 935, "y": 53.47}, {"x": 936, "y": 53.99}, {"x": 937, "y": 53.82}, {"x": 938, "y": 53.12}, {"x": 939, "y": 53.02}, {"x": 940, "y": 53.28}, {"x": 941, "y": 53.27}, {"x": 942, "y": 52.91}, {"x": 943, "y": 52.89}, {"x": 944, "y": 52.6}, {"x": 945, "y": 52.38}, {"x": 946, "y": 52.56}, {"x": 947, "y": 52.64}, {"x": 948, "y": 52.57}, {"x": 949, "y": 53.81}, {"x": 950, "y": 54.41}, {"x": 951, "y": 55.1}, {"x": 952, "y": 54.94}, {"x": 953, "y": 55.49}, {"x": 954, "y": 57.65}, {"x": 955, "y": 64.97}, {"x": 956, "y": 64.1}, {"x": 957, "y": 64.67}, {"x": 958, "y": 63.68}, {"x": 959, "y": 65.25}, {"x": 960, "y": 67.62}, {"x": 961, "y": 69.12}, {"x": 962, "y": 65.41}, {"x": 963, "y": 65.08}, {"x": 964, "y": 67.17}, {"x": 965, "y": 67.85}, {"x": 966, "y": 67.9}, {"x": 967, "y": 67.32}, {"x": 968, "y": 67.26}, {"x": 969, "y": 68.8}, {"x": 970, "y": 68.05}, {"x": 971, "y": 66.24}, {"x": 972, "y": 67.24}, {"x": 973, "y": 67.56}, {"x": 974, "y": 68.3}, {"x": 975, "y": 68.03}, {"x": 976, "y": 71.08}, {"x": 977, "y": 70.63}, {"x": 978, "y": 68.53}, {"x": 979, "y": 67.78}, {"x": 980, "y": 67.72}, {"x": 981, "y": 66.63}, {"x": 982, "y": 66.81}, {"x": 983, "y": 67.42}, {"x": 984, "y": 67.09}, {"x": 985, "y": 65.79}, {"x": 986, "y": 66.09}, {"x": 987, "y": 65.81}, {"x": 988, "y": 66.02}, {"x": 989, "y": 66.81}, {"x": 990, "y": 67.28}, {"x": 991, "y": 68.71}, {"x": 992, "y": 68.16}, {"x": 993, "y": 65.35}, {"x": 994, "y": 60.59}, {"x": 995, "y": 60.24}, {"x": 996, "y": 58.99}, {"x": 997, "y": 59.35}, {"x": 998, "y": 59.51}, {"x": 999, "y": 58.97}, {"x": 1000, "y": 59.77}, {"x": 1001, "y": 59.28}, {"x": 1002, "y": 59.74}, {"x": 1003, "y": 60.32}, {"x": 1004, "y": 61.29}, {"x": 1005, "y": 62.32}, {"x": 1006, "y": 63.24}, {"x": 1007, "y": 62.97}, {"x": 1008, "y": 62.93}, {"x": 1009, "y": 63.74}, {"x": 1010, "y": 63.17}, {"x": 1011, "y": 62.65}, {"x": 1012, "y": 60.28}, {"x": 1013, "y": 60.08}, {"x": 1014, "y": 61.55}, {"x": 1015, "y": 61.35}, {"x": 1016, "y": 61.69}, {"x": 1017, "y": 61.57}, {"x": 1018, "y": 62.43}, {"x": 1019, "y": 61.96}, {"x": 1020, "y": 61.86}, {"x": 1021, "y": 62.26}, {"x": 1022, "y": 60.8}, {"x": 1023, "y": 60.45}, {"x": 1024, "y": 60.99}, {"x": 1025, "y": 61.56}, {"x": 1026, "y": 61.57}, {"x": 1027, "y": 60.9}, {"x": 1028, "y": 62.43}, {"x": 1029, "y": 63.31}, {"x": 1030, "y": 65.51}, {"x": 1031, "y": 65.25}, {"x": 1032, "y": 66.82}, {"x": 1033, "y": 65.89}, {"x": 1034, "y": 65.84}, {"x": 1035, "y": 66.23}, {"x": 1036, "y": 65.8}, {"x": 1037, "y": 65.01}, {"x": 1038, "y": 65.59}, {"x": 1039, "y": 67.41}, {"x": 1040, "y": 68.63}, {"x": 1041, "y": 75.36}, {"x": 1042, "y": 75.17}, {"x": 1043, "y": 74.27}, {"x": 1044, "y": 75.07}, {"x": 1045, "y": 76.11}, {"x": 1046, "y": 75.48}, {"x": 1047, "y": 78.62}, {"x": 1048, "y": 79.02}, {"x": 1049, "y": 77.78}, {"x": 1050, "y": 77.94}, {"x": 1051, "y": 80.39}, {"x": 1052, "y": 79.22}, {"x": 1053, "y": 78.85}, {"x": 1054, "y": 80.2}, {"x": 1055, "y": 81.29}, {"x": 1056, "y": 89.8}, {"x": 1057, "y": 90.99}, {"x": 1058, "y": 89.82}, {"x": 1059, "y": 89.23}, {"x": 1060, "y": 90.31}, {"x": 1061, "y": 88.14}, {"x": 1062, "y": 91.02}, {"x": 1063, "y": 93.16}, {"x": 1064, "y": 93.96}, {"x": 1065, "y": 93.09}, {"x": 1066, "y": 92.25}, {"x": 1067, "y": 96.24}, {"x": 1068, "y": 101.82}, {"x": 1069, "y": 105.34}, {"x": 1070, "y": 103.65}, {"x": 1071, "y": 107.27}, {"x": 1072, "y": 108.13}, {"x": 1073, "y": 106.9}, {"x": 1074, "y": 106.99}, {"x": 1075, "y": 110.71}, {"x": 1076, "y": 111.09}, {"x": 1077, "y": 107.84}, {"x": 1078, "y": 99.53}, {"x": 1079, "y": 101.94}, {"x": 1080, "y": 104.68}, {"x": 1081, "y": 113.25}, {"x": 1082, "y": 113.39}, {"x": 1083, "y": 110.27}, {"x": 1084, "y": 111.73}, {"x": 1085, "y": 111.33}, {"x": 1086, "y": 109.33}, {"x": 1087, "y": 110.72}, {"x": 1088, "y": 110.72}, {"x": 1089, "y": 110.01}, {"x": 1090, "y": 106.27}, {"x": 1091, "y": 105.8}, {"x": 1092, "y": 104.29}, {"x": 1093, "y": 108.03}, {"x": 1094, "y": 110.67}, {"x": 1095, "y": 110.31}, {"x": 1096, "y": 111.57}, {"x": 1097, "y": 122.92}, {"x": 1098, "y": 135.69}, {"x": 1099, "y": 132.76}, {"x": 1100, "y": 137.81}, {"x": 1101, "y": 138.51}, {"x": 1102, "y": 137.42}, {"x": 1103, "y": 135.9}, {"x": 1104, "y": 137.4}, {"x": 1105, "y": 135.66}, {"x": 1106, "y": 141.33}, {"x": 1107, "y": 153.18}, {"x": 1108, "y": 162.04}, {"x": 1109, "y": 156.79}, {"x": 1110, "y": 156.27}, {"x": 1111, "y": 165.32}, {"x": 1112, "y": 167.05}, {"x": 1113, "y": 168.76}, {"x": 1114, "y": 189.85}, {"x": 1115, "y": 198.28}, {"x": 1116, "y": 191.56}, {"x": 1117, "y": 195.9}, {"x": 1118, "y": 210.6}, {"x": 1119, "y": 230.13}, {"x": 1120, "y": 239.17}, {"x": 1121, "y": 235.92}, {"x": 1122, "y": 235.75}, {"x": 1123, "y": 218.16}, {"x": 1124, "y": 208.83}, {"x": 1125, "y": 215.79}, {"x": 1126, "y": 228.62}, {"x": 1127, "y": 226.61}, {"x": 1128, "y": 216.36}, {"x": 1129, "y": 210.11}, {"x": 1130, "y": 213.63}, {"x": 1131, "y": 215.79}, {"x": 1132, "y": 207.61}, {"x": 1133, "y": 202.97}, {"x": 1134, "y": 192.86}, {"x": 1135, "y": 190.74}, {"x": 1136, "y": 188.55}, {"x": 1137, "y": 198.83}, {"x": 1138, "y": 187.7}, {"x": 1139, "y": 185.62}, {"x": 1140, "y": 192.61}, {"x": 1141, "y": 219.68}, {"x": 1142, "y": 199.16}, {"x": 1143, "y": 195.8}, {"x": 1144, "y": 197.93}, {"x": 1145, "y": 205.16}, {"x": 1146, "y": 214.73}, {"x": 1147, "y": 220.69}, {"x": 1148, "y": 218.42}, {"x": 1149, "y": 233.5}, {"x": 1150, "y": 226.34}, {"x": 1151, "y": 266.79}, {"x": 1152, "y": 274.47}, {"x": 1153, "y": 269.73}, {"x": 1154, "y": 277.53}, {"x": 1155, "y": 279.28}, {"x": 1156, "y": 274.52}, {"x": 1157, "y": 283.4}, {"x": 1158, "y": 279.43}, {"x": 1159, "y": 288.99}, {"x": 1160, "y": 300.0}, {"x": 1161, "y": 299.49}, {"x": 1162, "y": 321.37}, {"x": 1163, "y": 328.97}, {"x": 1164, "y": 332.69}, {"x": 1165, "y": 327.87}, {"x": 1166, "y": 308.92}, {"x": 1167, "y": 292.9}, {"x": 1168, "y": 296.71}, {"x": 1169, "y": 276.08}, {"x": 1170, "y": 275.91}, {"x": 1171, "y": 265.9}, {"x": 1172, "y": 283.87}, {"x": 1173, "y": 286.21}, {"x": 1174, "y": 300.12}, {"x": 1175, "y": 295.18}, {"x": 1176, "y": 281.92}, {"x": 1177, "y": 280.5}, {"x": 1178, "y": 293.33}, {"x": 1179, "y": 298.76}, {"x": 1180, "y": 312.97}, {"x": 1181, "y": 327.18}, {"x": 1182, "y": 331.53}, {"x": 1183, "y": 331.14}, {"x": 1184, "y": 352.59}, {"x": 1185, "y": 351.91}, {"x": 1186, "y": 345.69}, {"x": 1187, "y": 324.62}, {"x": 1188, "y": 336.23}, {"x": 1189, "y": 342.82}, {"x": 1190, "y": 339.05}, {"x": 1191, "y": 341.39}, {"x": 1192, "y": 334.03}, {"x": 1193, "y": 333.13}, {"x": 1194, "y": 318.31}, {"x": 1195, "y": 326.11}, {"x": 1196, "y": 303.81}, {"x": 1197, "y": 313.99}, {"x": 1198, "y": 323.27}, {"x": 1199, "y": 322.46}, {"x": 1200, "y": 332.99}, {"x": 1201, "y": 338.48}, {"x": 1202, "y": 340.94}, {"x": 1203, "y": 339.17}, {"x": 1204, "y": 343.22}, {"x": 1205, "y": 340.89}, {"x": 1206, "y": 333.49}, {"x": 1207, "y": 337.93}, {"x": 1208, "y": 339.2}, {"x": 1209, "y": 334.41}, {"x": 1210, "y": 331.55}, {"x": 1211, "y": 335.78}, {"x": 1212, "y": 350.63}, {"x": 1213, "y": 346.06}, {"x": 1214, "y": 349.49}, {"x": 1215, "y": 363.62}, {"x": 1216, "y": 369.75}, {"x": 1217, "y": 363.74}, {"x": 1218, "y": 362.15}, {"x": 1219, "y": 356.37}, {"x": 1220, "y": 344.92}, {"x": 1221, "y": 327.98}, {"x": 1222, "y": 325.41}, {"x": 1223, "y": 323.59}, {"x": 1224, "y": 316.55}, {"x": 1225, "y": 297.22}, {"x": 1226, "y": 291.71}, {"x": 1227, "y": 288.3}, {"x": 1228, "y": 309.9}, {"x": 1229, "y": 316.19}, {"x": 1230, "y": 321.71}, {"x": 1231, "y": 314.69}, {"x": 1232, "y": 330.47}, {"x": 1233, "y": 333.29}, {"x": 1234, "y": 330.17}, {"x": 1235, "y": 336.27}, {"x": 1236, "y": 326.11}, {"x": 1237, "y": 331.07}, {"x": 1238, "y": 332.73}, {"x": 1239, "y": 334.38}, {"x": 1240, "y": 339.23}, {"x": 1241, "y": 338.09}, {"x": 1242, "y": 339.23}, {"x": 1243, "y": 324.19}, {"x": 1244, "y": 330.68}, {"x": 1245, "y": 292.86}, {"x": 1246, "y": 293.52}, {"x": 1247, "y": 289.06}, {"x": 1248, "y": 283.9}, {"x": 1249, "y": 266.17}, {"x": 1250, "y": 261.12}, {"x": 1251, "y": 248.49}, {"x": 1252, "y": 242.03}, {"x": 1253, "y": 240.6}, {"x": 1254, "y": 221.38}, {"x": 1255, "y": 218.19}, {"x": 1256, "y": 227.6}, {"x": 1257, "y": 226.87}, {"x": 1258, "y": 232.85}, {"x": 1259, "y": 230.4}, {"x": 1260, "y": 221.65}, {"x": 1261, "y": 212.88}, {"x": 1262, "y": 208.03}, {"x": 1263, "y": 213.79}, {"x": 1264, "y": 216.05}, {"x": 1265, "y": 217.93}, {"x": 1266, "y": 225.06}, {"x": 1267, "y": 224.0}, {"x": 1268, "y": 216.22}, {"x": 1269, "y": 207.98}, {"x": 1270, "y": 210.38}, {"x": 1271, "y": 194.23}, {"x": 1272, "y": 214.0}, {"x": 1273, "y": 219.45}, {"x": 1274, "y": 214.83}, {"x": 1275, "y": 213.59}, {"x": 1276, "y": 224.52}, {"x": 1277, "y": 234.12}, {"x": 1278, "y": 235.64}, {"x": 1279, "y": 231.06}, {"x": 1280, "y": 225.54}, {"x": 1281, "y": 217.81}, {"x": 1282, "y": 207.85}, {"x": 1283, "y": 206.03}, {"x": 1284, "y": 203.82}, {"x": 1285, "y": 189.85}, {"x": 1286, "y": 198.87}, {"x": 1287, "y": 201.24}, {"x": 1288, "y": 202.4}, {"x": 1289, "y": 186.6}, {"x": 1290, "y": 198.11}, {"x": 1291, "y": 201.24}, {"x": 1292, "y": 208.67}, {"x": 1293, "y": 205.82}, {"x": 1294, "y": 199.87}, {"x": 1295, "y": 193.71}, {"x": 1296, "y": 199.24}, {"x": 1297, "y": 205.06}, {"x": 1298, "y": 201.22}, {"x": 1299, "y": 200.22}, {"x": 1300, "y": 199.88}, {"x": 1301, "y": 193.44}, {"x": 1302, "y": 194.41}, {"x": 1303, "y": 195.34}, {"x": 1304, "y": 197.64}, {"x": 1305, "y": 197.71}, {"x": 1306, "y": 190.08}, {"x": 1307, "y": 188.79}, {"x": 1308, "y": 189.2}, {"x": 1309, "y": 183.86}, {"x": 1310, "y": 182.19}, {"x": 1311, "y": 184.92}, {"x": 1312, "y": 181.87}, {"x": 1313, "y": 177.1}, {"x": 1314, "y": 187.33}, {"x": 1315, "y": 185.81}, {"x": 1316, "y": 191.85}, {"x": 1317, "y": 196.7}, {"x": 1318, "y": 201.81}, {"x": 1319, "y": 231.19}, {"x": 1320, "y": 225.44}, {"x": 1321, "y": 233.18}, {"x": 1322, "y": 231.7}, {"x": 1323, "y": 241.26}, {"x": 1324, "y": 242.01}, {"x": 1325, "y": 242.87}, {"x": 1326, "y": 230.79}, {"x": 1327, "y": 226.8}, {"x": 1328, "y": 227.88}, {"x": 1329, "y": 235.75}, {"x": 1330, "y": 247.39}, {"x": 1331, "y": 254.85}, {"x": 1332, "y": 258.33}, {"x": 1333, "y": 264.85}, {"x": 1334, "y": 266.25}, {"x": 1335, "y": 266.5}, {"x": 1336, "y": 263.5}, {"x": 1337, "y": 273.01}, {"x": 1338, "y": 274.48}, {"x": 1339, "y": 270.08}, {"x": 1340, "y": 273.97}, {"x": 1341, "y": 268.87}, {"x": 1342, "y": 262.26}, {"x": 1343, "y": 268.15}, {"x": 1344, "y": 281.55}, {"x": 1345, "y": 283.68}, {"x": 1346, "y": 282.21}, {"x": 1347, "y": 287.92}, {"x": 1348, "y": 284.27}, {"x": 1349, "y": 280.87}, {"x": 1350, "y": 281.38}, {"x": 1351, "y": 280.22}, {"x": 1352, "y": 281.07}, {"x": 1353, "y": 282.97}, {"x": 1354, "y": 278.73}, {"x": 1355, "y": 275.07}, {"x": 1356, "y": 280.25}, {"x": 1357, "y": 287.63}, {"x": 1358, "y": 290.77}, {"x": 1359, "y": 288.12}, {"x": 1360, "y": 295.9}, {"x": 1361, "y": 300.92}, {"x": 1362, "y": 301.71}, {"x": 1363, "y": 269.91}, {"x": 1364, "y": 270.24}, {"x": 1365, "y": 268.15}, {"x": 1366, "y": 262.19}, {"x": 1367, "y": 264.88}, {"x": 1368, "y": 267.28}, {"x": 1369, "y": 269.39}, {"x": 1370, "y": 276.51}, {"x": 1371, "y": 276.84}, {"x": 1372, "y": 274.52}, {"x": 1373, "y": 278.47}, {"x": 1374, "y": 275.79}, {"x": 1375, "y": 269.94}, {"x": 1376, "y": 248.8}, {"x": 1377, "y": 250.86}, {"x": 1378, "y": 256.43}, {"x": 1379, "y": 257.7}, {"x": 1380, "y": 244.97}, {"x": 1381, "y": 250.57}, {"x": 1382, "y": 252.85}, {"x": 1383, "y": 243.94}, {"x": 1384, "y": 242.82}, {"x": 1385, "y": 251.66}, {"x": 1386, "y": 276.49}, {"x": 1387, "y": 275.58}, {"x": 1388, "y": 280.66}, {"x": 1389, "y": 282.42}, {"x": 1390, "y": 295.82}, {"x": 1391, "y": 317.85}, {"x": 1392, "y": 315.47}, {"x": 1393, "y": 319.84}, {"x": 1394, "y": 316.36}, {"x": 1395, "y": 322.47}, {"x": 1396, "y": 329.76}, {"x": 1397, "y": 328.85}, {"x": 1398, "y": 329.4}, {"x": 1399, "y": 333.71}, {"x": 1400, "y": 358.8}, {"x": 1401, "y": 355.64}, {"x": 1402, "y": 351.88}, {"x": 1403, "y": 357.45}, {"x": 1404, "y": 367.65}, {"x": 1405, "y": 381.99}, {"x": 1406, "y": 379.93}, {"x": 1407, "y": 363.36}, {"x": 1408, "y": 352.04}, {"x": 1409, "y": 350.63}, {"x": 1410, "y": 363.23}, {"x": 1411, "y": 360.86}, {"x": 1412, "y": 350.61}, {"x": 1413, "y": 356.33}, {"x": 1414, "y": 359.07}, {"x": 1415, "y": 355.53}, {"x": 1416, "y": 355.79}, {"x": 1417, "y": 355.98}, {"x": 1418, "y": 366.42}, {"x": 1419, "y": 362.03}, {"x": 1420, "y": 359.67}, {"x": 1421, "y": 356.88}, {"x": 1422, "y": 350.98}, {"x": 1423, "y": 360.82}]}];
        var boxes = [{"Cycle": 2, "Box_ID": 1, "Start_Day": 481, "Start_Timestamp": "2019/04/10", "Start_Rate": 30.91, "Low_Day": 818, "Low_Timestamp": "2020/03/12", "Low_Rate": 25.14, "End_Day": 819, "End_Timestamp": "2020/03/13", "End_Rate": 33.95, "Drop_Percent": 5.77, "Duration_Days": 338, "Box_Broken": true, "color": "#3B82F6"}, {"Cycle": 2, "Box_ID": 2, "Start_Day": 844, "Start_Timestamp": "2020/04/07", "Start_Rate": 42.53, "Low_Day": 853, "Low_Timestamp": "2020/04/16", "Low_Rate": 36.88, "End_Day": 860, "End_Timestamp": "2020/04/23", "End_Rate": 44.12, "Drop_Percent": 5.65, "Duration_Days": 16, "Box_Broken": true, "color": "#10B981"}, {"Cycle": 2, "Box_ID": 3, "Start_Day": 874, "Start_Timestamp": "2020/05/07", "Start_Rate": 57.4, "Low_Day": 877, "Low_Timestamp": "2020/05/10", "Low_Rate": 46.28, "End_Day": 899, "End_Timestamp": "2020/06/01", "End_Rate": 59.18, "Drop_Percent": 11.12, "Duration_Days": 25, "Box_Broken": true, "color": "#EF4444"}, {"Cycle": 2, "Box_ID": 4, "Start_Day": 920, "Start_Timestamp": "2020/06/22", "Start_Rate": 55.76, "Low_Day": 925, "Low_Timestamp": "2020/06/27", "Low_Rate": 50.36, "End_Day": 954, "End_Timestamp": "2020/07/26", "End_Rate": 57.65, "Drop_Percent": 5.4, "Duration_Days": 34, "Box_Broken": true, "color": "#F59E0B"}, {"Cycle": 2, "Box_ID": 5, "Start_Day": 961, "Start_Timestamp": "2020/08/02", "Start_Rate": 69.12, "Low_Day": 962, "Low_Timestamp": "2020/08/03", "Low_Rate": 62.35, "End_Day": 976, "End_Timestamp": "2020/08/17", "End_Rate": 71.08, "Drop_Percent": 6.77, "Duration_Days": 15, "Box_Broken": true, "color": "#8B5CF6"}, {"Cycle": 2, "Box_ID": 6, "Start_Day": 991, "Start_Timestamp": "2020/09/01", "Start_Rate": 68.71, "Low_Day": 995, "Low_Timestamp": "2020/09/05", "Low_Rate": 56.02, "End_Day": 1041, "End_Timestamp": "2020/10/21", "End_Rate": 75.36, "Drop_Percent": 12.69, "Duration_Days": 50, "Box_Broken": true, "color": "#EC4899"}, {"Cycle": 2, "Box_ID": 7, "Start_Day": 1082, "Start_Timestamp": "2020/12/01", "Start_Rate": 113.39, "Low_Day": 1092, "Low_Timestamp": "2020/12/11", "Low_Rate": 100.19, "End_Day": 1097, "End_Timestamp": "2020/12/16", "End_Rate": 122.92, "Drop_Percent": 13.2, "Duration_Days": 15, "Box_Broken": true, "color": "#06B6D4"}, {"Cycle": 2, "Box_ID": 8, "Start_Day": 1120, "Start_Timestamp": "2021/01/08", "Start_Rate": 239.17, "Low_Day": 1134, "Low_Timestamp": "2021/01/22", "Low_Rate": 164.48, "End_Day": 1151, "End_Timestamp": "2021/02/08", "End_Rate": 266.79, "Drop_Percent": 74.69, "Duration_Days": 31, "Box_Broken": true, "color": "#84CC16"}, {"Cycle": 2, "Box_ID": 9, "Start_Day": 1164, "Start_Timestamp": "2021/02/21", "Start_Rate": 332.69, "Low_Day": 1171, "Low_Timestamp": "2021/02/28", "Low_Rate": 245.16, "End_Day": 1184, "End_Timestamp": "2021/03/13", "End_Rate": 352.59, "Drop_Percent": 87.53, "Duration_Days": 20, "Box_Broken": true, "color": "#3B82F6"}, {"Cycle": 2, "Box_ID": 10, "Start_Day": 1216, "Start_Timestamp": "2021/04/14", "Start_Rate": 369.75, "Low_Day": 1285, "Low_Timestamp": "2021/06/22", "Low_Rate": 164.23, "End_Day": 1405, "End_Timestamp": "2021/10/20", "End_Rate": 381.99, "Drop_Percent": 205.53, "Duration_Days": 189, "Box_Broken": true, "color": "#10B981"}, {"Cycle": 2, "Box_ID": 11, "Start_Day": 1418, "Start_Timestamp": "2021/11/02", "Start_Rate": 366.42, "Low_Day": 1422, "Low_Timestamp": "2021/11/06", "Low_Rate": 342.36, "End_Day": 1423, "End_Timestamp": "2021/11/07", "End_Rate": 360.82, "Drop_Percent": 24.06, "Duration_Days": 5, "Box_Broken": true, "color": "#EF4444"}];
        var chartInstance = null;

        // 마우스 위치에 따른 박스 정보 표시
        function getBoxAtPosition(dayX) {
            for (let box of boxes) {
                if (dayX >= box.Start_Day && dayX <= box.End_Day) {
                    return box;
                }
            }
            return null;
        }
        
        // 박스 사각형 그리기 함수
        function drawBoxRects(chartContext) {
            if (!chartContext) return;
            
            var chartEl = chartContext.el;
            var gridRect = chartEl.querySelector('.apexcharts-grid');
            if (!gridRect) return;
            
            // 기존 박스 rect 제거
            var oldRects = chartEl.querySelectorAll('.box-rect-group');
            oldRects.forEach(function(el) { el.remove(); });
            
            // 새 그룹 생성
            var rectGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            rectGroup.setAttribute('class', 'box-rect-group');
            
            var w = chartContext.w;
            
            // X축, Y축 config에서 고정값 사용
            var xMin = w.config.xaxis.min !== undefined ? w.config.xaxis.min : w.globals.minX;
            var xMax = w.config.xaxis.max !== undefined ? w.config.xaxis.max : w.globals.maxX;
            var yMin = w.config.yaxis[0].min !== undefined ? w.config.yaxis[0].min : 0;
            var yMax = w.config.yaxis[0].max !== undefined ? w.config.yaxis[0].max : 100;
            
            // 실제 그리드 영역 계산 (SVG 요소에서 직접)
            var gridBBox = gridRect.getBBox();
            var gridX = gridBBox.x;
            var gridY = gridBBox.y;
            var gridWidth = gridBBox.width;
            var gridHeight = gridBBox.height;
            
            boxes.forEach(function(box) {
                // X 좌표 계산 (Start_Day ~ End_Day)
                var x1 = gridX + ((box.Start_Day - xMin) / (xMax - xMin)) * gridWidth;
                var x2 = gridX + ((box.End_Day - xMin) / (xMax - xMin)) * gridWidth;
                
                // Y 좌표 계산 (bull: Start_Rate가 고점, Low_Rate가 저점)
                var yTop = gridY + ((yMax - box.Start_Rate) / (yMax - yMin)) * gridHeight;
                var yBottom = gridY + ((yMax - box.Low_Rate) / (yMax - yMin)) * gridHeight;
                
                var rectWidth = Math.abs(x2 - x1);
                var rectHeight = Math.abs(yBottom - yTop);
                var rectX = Math.min(x1, x2);
                var rectY = Math.min(yTop, yBottom);
                
                // 화면 범위 체크
                if (rectWidth > 0 && rectHeight > 0) {
                    var rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttribute('x', rectX);
                    rect.setAttribute('y', rectY);
                    rect.setAttribute('width', rectWidth);
                    rect.setAttribute('height', rectHeight);
                    rect.setAttribute('fill', box.color);
                    rect.setAttribute('fill-opacity', '0.15');
                    rect.setAttribute('stroke', box.color);
                    rect.setAttribute('stroke-width', '1.5');
                    rect.setAttribute('stroke-opacity', '0.8');
                    rectGroup.appendChild(rect);
                }
            });
            
            // grid 뒤에 삽입
            if (gridRect && gridRect.parentNode) {
                gridRect.parentNode.insertBefore(rectGroup, gridRect);
            }
        }

        // point annotations (고점/저점 마커)
        var pointAnnotations = [];
        var highColor = '#EF4444';  // 고점: 빨강
        var lowColor = '#10B981';   // 저점: 초록
        
        boxes.forEach(function(box, idx) {
            // 전저점 찾기 (이전 박스의 저점, 없으면 현재 고점 기준)
            var prevLow = idx > 0 ? boxes[idx - 1].Low_Rate : box.Start_Rate;
            var riseFromPrevLow = ((box.Start_Rate - prevLow) / prevLow * 100).toFixed(0);
            
            // 고점 대비 하락률
            var dropFromHigh = (-(box.Start_Rate - box.Low_Rate) / box.Start_Rate * 100).toFixed(0);
            
            // 고점 마커 (삼각형, 원 위에 라벨)
            pointAnnotations.push({
                x: box.Start_Day,
                y: box.Start_Rate,
                marker: { size: 5, fillColor: highColor, strokeColor: '#fff', strokeWidth: 1, shape: 'triangle' },
                label: { 
                    borderColor: highColor, 
                    style: { color: '#fff', background: highColor, fontSize: '9px', padding: { left: 4, right: 4, top: 1, bottom: 1 } }, 
                    text: 'H' + box.Box_ID + ' ' + box.Start_Rate + '% 전저점:+' + riseFromPrevLow + '%', 
                    offsetY: -8 
                }
            });
            
            // 저점 마커 (원, 원 아래에 라벨)
            pointAnnotations.push({
                x: box.Low_Day,
                y: box.Low_Rate,
                marker: { size: 5, fillColor: lowColor, strokeColor: '#fff', strokeWidth: 1 },
                label: { 
                    borderColor: lowColor, 
                    style: { color: '#fff', background: lowColor, fontSize: '9px', padding: { left: 4, right: 4, top: 1, bottom: 1 } }, 
                    text: 'L' + box.Box_ID + ' ' + box.Low_Rate + '% 고점:' + dropFromHigh + '%', 
                    offsetY: 38,
                    position: 'bottom'
                }
            });
        });

        var options = {
            chart: { 
                type: 'line', 
                height: '100%', 
                fontFamily: "'JetBrains Mono', monospace", 
                background: 'transparent', 
                toolbar: { show: true }, 
                zoom: { enabled: true, type: 'xy' },
                events: {
                    mounted: function(chartContext, config) {
                        chartInstance = chartContext;
                        setTimeout(function() { drawBoxRects(chartContext); }, 100);
                    },
                    updated: function(chartContext, config) {
                        setTimeout(function() { drawBoxRects(chartContext); }, 50);
                    },
                    zoomed: function(chartContext, config) {
                        setTimeout(function() { drawBoxRects(chartContext); }, 50);
                    },
                    beforeResetZoom: function(chartContext, config) {
                        setTimeout(function() { drawBoxRects(chartContext); }, 100);
                        return config;
                    },
                    animationEnd: function(chartContext, config) {
                        drawBoxRects(chartContext);
                    },
                    selection: function(chartContext, config) {
                        setTimeout(function() { drawBoxRects(chartContext); }, 50);
                    }
                }
            },
            series: series,
            colors: ['#3B82F6'],
            stroke: { curve: 'smooth', width: 2 },
            grid: { borderColor: 'rgba(255,255,255,0.08)', strokeDashArray: 4 },
            xaxis: { type: 'numeric', min: 420, max: 1423, tickAmount: 10, title: { text: 'Days Since Peak', style: { color: '#94A3B8' } }, labels: { style: { colors: '#94A3B8' } } },
            yaxis: { min: 0, max: 430, tickAmount: 10, title: { text: 'Rate (% of Peak)', style: { color: '#94A3B8' } }, labels: { style: { colors: '#94A3B8' }, formatter: function(v) { return v + '%'; } } },
            tooltip: { 
                theme: 'dark',
                custom: function({series, seriesIndex, dataPointIndex, w}) {
                    var data = w.globals.initialSeries[seriesIndex].data;
                    var point = data[dataPointIndex];
                    var dayX = point.x;
                    var val = point.y.toFixed(2);
                    var box = getBoxAtPosition(dayX);
                    
                    if (box) {
                        return '<div style="padding:12px; background:' + box.color + '; border-radius:6px; color:#000; font-weight:bold; border:2px solid #fff;">' +
                            'Box ' + box.Box_ID + '<br/>' +
                            '<span style="font-size:14px;">-' + box.Drop_Percent.toFixed(1) + '%</span><br/>' +
                            '<span style="font-size:11px;">Day ' + box.Start_Day + '-' + box.End_Day + ' (' + box.Duration_Days + 'd)</span><br/>' +
                            '<span style="font-size:10px;opacity:0.9;">High: ' + box.Start_Rate + '% → Low: ' + box.Low_Rate + '%</span>' +
                            '</div>';
                    }
                    
                    return '<div style="padding:8px; background:rgba(59,130,246,0.9); border-radius:6px; color:#fff;">' +
                        '<span>Day ' + dayX + '</span><br/>' +
                        '<span style="font-size:12px;">Rate: ' + val + '%</span>' +
                        '</div>';
                }
            },
            annotations: { points: pointAnnotations },
            legend: { show: false }
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
        
        // 홈 버튼 클릭 감지 (toolbar 버튼 클릭 시 박스 다시 그리기)
        setTimeout(function() {
            var toolbar = document.querySelector('.apexcharts-toolbar');
            if (toolbar) {
                toolbar.addEventListener('click', function(e) {
                    // 홈 버튼 또는 다른 툴바 버튼 클릭 시
                    setTimeout(function() {
                        if (chartInstance) drawBoxRects(chartInstance);
                    }, 300);
                });
            }
            
            // MutationObserver로 차트 변경 감지
            var chartEl = document.querySelector('#chart');
            var observer = new MutationObserver(function(mutations) {
                if (chartInstance) {
                    setTimeout(function() { drawBoxRects(chartInstance); }, 50);
                }
            });
            observer.observe(chartEl, { childList: true, subtree: true });
        }, 500);
    </script>
</body>
</html>